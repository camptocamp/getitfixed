<?python import json ?>
<script>
(function(){
  c2cgeoform.setItemIcon(${structure: json.dumps(obj.icon_url)})
})()
</script>
<div tal:define="item_template item_template|field.widget.readonly_item_template if readonly else field.widget.item_template;"
     tal:repeat="child field.children"
     tal:replace="structure child.render_template(item_template)" >
</div>
<script tal:condition="exists: deps">
(function(){
  const dependencies = ${structure: json.dumps(deps)}
  if (!dependencies) return
  const [parent, child] = [0,1].map(
    i => $(`select[name=$${dependencies.fields[i]}]`)
  )
  parent.on('change', () => {
    const options = dependencies.values.filter(v => v.cat == parent.val())
    child.empty().append(
      options.map(o =>`<option value="$${o.id}">$${o.label}</option>`)
    )
  })
  parent.trigger('change')
})()
</script>
